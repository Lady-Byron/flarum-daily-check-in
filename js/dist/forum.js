(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t);const n=flarum.core.compat.extend,r=flarum.core.compat["forum/components/IndexPage"];var a=e.n(r);const o=flarum.core.compat["components/Button"];var c=e.n(o);const i=flarum.core.compat["common/components/Alert"];var u=e.n(i);function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}const l=flarum.core.compat["components/Modal"];var f=e.n(l),h=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var n=t.prototype;return n.oninit=function(t){e.prototype.oninit.call(this,t)},n.className=function(){return"checkInResultModal Modal--small"},n.title=function(){return m("div",{className:"checkInResultModal successTitleText"},app.translator.trans("ziven-checkin.forum.check-in-success"))},n.renderWithBreaks=function(e){var t=String(null!=e?e:"").replace(/\\n/g,"\n").split(/\r?\n/g),n=[];return t.forEach((function(e,t){t&&n.push(m("br",null)),n.push(e)})),n},n.content=function(){var e=app.session.user,t=Number(e.attribute("totalContinuousCheckIn")||0),n=Number(app.forum.attribute("forumCheckinRewarMoney")||0),r=Number(app.forum.attribute("forumCheckinRewardExp")||0),a=Number(app.forum.attribute("forumCheckinStreakBonusExpPerDay")||0),o=Number(app.forum.attribute("forumCheckinStreakBonusMoneyPerDay")||0),c=Number(app.forum.attribute("forumCheckinStreakBonusMaxDays")||0),i=c>0?Math.min(t,c):t,u=Math.max(0,i-1)*Math.max(0,a),s=Math.max(0,i-1)*Math.max(0,o),p=r+u,l=n+s,f=app.forum.attribute("forumCheckinSuccessPromptText")||"",h=app.forum.attribute("forumCheckinSuccessPromptRewardText")||"",d=app.forum.attribute("antoinefr-money.moneyname"),k=void 0!==d,y=function(e){var t=Number(e).toString(),n=d||"";return n?n.includes("[money]")?n.replace(/\[money\]/g,t):t+" "+n:t},b=function(e){if(!e)return"";var a=e.replace(/\[days\]/g,String(t)).replace(/\[eff_days\]/g,String(i)).replace(/\[base_money\]/g,y(n)).replace(/\[bonus_money\]/g,y(s)).replace(/\[money\]/g,y(l)).replace(/\[base_exp\]/g,String(r)).replace(/\[bonus_exp\]/g,String(u)).replace(/\[exp\]/g,String(p)),o=k?y(l):String(p);return a.replace(/\[reward\]/g,o)},v=b(f),C=b(h),g=C?"checkInResultModal rewardText":"checkInResultModal hideText";return m("div",{className:"Modal-body"},m("div",{className:v?"checkInResultModal successText":"checkInResultModal hideText"},this.renderWithBreaks(v)),m("div",{className:g},this.renderWithBreaks(C)))},t}(f());flarum.core.compat["utils/Stream"];var d=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var n=t.prototype;return n.oninit=function(t){e.prototype.oninit.call(this,t)},n.className=function(){return"checkInResultModal Modal--small"},n.title=function(){return m("div",{className:"checkInResultModal failedTitleText"},app.translator.trans("ziven-checkin.forum.check-in-failed"))},n.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"checkInResultModal successText"},app.translator.trans("ziven-checkin.forum.try-again-later")))},t}(f());app.initializers.add("ziven-checkin",(function(){(0,n.extend)(a().prototype,"sidebarItems",(function(e){if(null!==app.session.user&&!0===app.forum.attribute("allowCheckIn")){var t,n=app.current.get("routeName"),r=app.session.user.attribute("totalContinuousCheckIn"),a=app.session.user.attribute("canCheckin"),o=app.session.user.attribute("canCheckinContinuous"),i=(app.session.user.attribute("serverDate"),app.forum.attribute("forumCheckinSuccessPromptType")),s=app.session.user.attribute("checkInCompatibleExtensions"),p=(app.session.user.attribute("lastCheckinTime"),"forum-checkin");if("tag"===n&&-1!==s.indexOf("fof-follow-tags")&&(p="forum-checkin-1"),!0===a){t=app.translator.trans("ziven-checkin.forum.check-in"),e.add(p,c().component({icon:"fas fa-calendar",className:"Button CheckInButton--yellow",itemClassName:"App-primaryControl",id:"checkInButton",onclick:function(){app.session.user.save({canCheckin:!1,totalContinuousCheckIn:!0===o?r+1:1}).then((function(){var e=app.forum.attribute("forumCheckinSuccessPromptText"),t=app.forum.attribute("forumCheckinSuccessPromptRewardText"),n=app.session.user.attribute("canCheckin");if(""!==e||""!==t)if(1===i)if(!1===n){var r=app.forum.attribute("forumCheckinRewarMoney"),a=void 0!==app.forum.attribute("antoinefr-money.moneyname"),o="";if(""!==e){var c=e.replace("[days]",app.session.user.attribute("totalContinuousCheckIn"));app.alerts.show(u(),{type:"success"},c)}if(!0===a&&""!==t){o=(app.forum.attribute("antoinefr-money.moneyname")||"[money]").replace("[money]",r);var s=t.replace("[reward]",o);app.alerts.show(u(),{type:"success"},s)}}else app.alerts.show(u(),{type:"error"},app.translator.trans("ziven-checkin.forum.check-in-failed")+" "+app.translator.trans("ziven-checkin.forum.try-again-later"));else 2===i&&(!1===n?app.modal.show(h):app.modal.show(d))}))}},t),50);var l=app.forum.attribute("forumAutoCheckin"),m=app.forum.attribute("forumAutoCheckinDelay");1===l&&setTimeout((function(){$("#checkInButton").click()}),m)}else t=r<=1?app.translator.trans("ziven-checkin.forum.checked-in-day",{count:r}):app.translator.trans("ziven-checkin.forum.checked-in-days",{count:r}),e.add(p,c().component({icon:"fas fa-calendar-check",className:"Button CheckInButton--green",itemClassName:"App-primaryControl",disabled:!0},t),50)}}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map