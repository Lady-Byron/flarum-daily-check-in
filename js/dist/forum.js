(()=>{var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t);const a=flarum.core.compat.extend,n=flarum.core.compat["forum/components/IndexPage"];var r=e.n(n);const o=flarum.core.compat["components/Button"];var c=e.n(o);const u=flarum.core.compat["common/components/Alert"];var i=e.n(u);function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}const l=flarum.core.compat["components/Modal"];var f=e.n(l),h=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t)},a.className=function(){return"checkInResultModal Modal--small"},a.title=function(){return m("div",{className:"checkInResultModal successTitleText"},app.translator.trans("ziven-checkin.forum.check-in-success"))},a.content=function(){var e=app.session.user,t=Number(e.attribute("totalContinuousCheckIn")||0),a=Number(app.forum.attribute("forumCheckinRewarMoney")||0),n=Number(app.forum.attribute("forumCheckinRewardExp")||0),r=Number(app.forum.attribute("forumCheckinStreakBonusExpPerDay")||0),o=Number(app.forum.attribute("forumCheckinStreakBonusMoneyPerDay")||0),c=Number(app.forum.attribute("forumCheckinStreakBonusMaxDays")||0),u=c>0?Math.min(t,c):t,i=Math.max(0,u-1)*Math.max(0,r),s=Math.max(0,u-1)*Math.max(0,o),p=n+i,l=a+s,f=app.forum.attribute("forumCheckinSuccessPromptText")||"",h=app.forum.attribute("forumCheckinSuccessPromptRewardText")||"",d=app.forum.attribute("antoinefr-money.moneyname"),k=void 0!==d,y=function(e){var t=Number(e).toString(),a=d||"";return a?a.includes("[money]")?a.replace(/\[money\]/g,t):t+" "+a:t},b=function(e){if(!e)return"";var r=e.replace(/\[days\]/g,String(t)).replace(/\[eff_days\]/g,String(u)).replace(/\[base_money\]/g,y(a)).replace(/\[bonus_money\]/g,y(s)).replace(/\[money\]/g,y(l)).replace(/\[base_exp\]/g,String(n)).replace(/\[bonus_exp\]/g,String(i)).replace(/\[exp\]/g,String(p)),o=k?y(l):String(p);return r.replace(/\[reward\]/g,o)},v=b(f),C=b(h),g=C?"checkInResultModal rewardText":"checkInResultModal hideText";return m("div",{className:"Modal-body"},m("div",{className:v?"checkInResultModal successText":"checkInResultModal hideText"},v),m("div",{className:g},C))},t}(f());flarum.core.compat["utils/Stream"];var d=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t)},a.className=function(){return"checkInResultModal Modal--small"},a.title=function(){return m("div",{className:"checkInResultModal failedTitleText"},app.translator.trans("ziven-checkin.forum.check-in-failed"))},a.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"checkInResultModal successText"},app.translator.trans("ziven-checkin.forum.try-again-later")))},t}(f());app.initializers.add("ziven-checkin",(function(){(0,a.extend)(r().prototype,"sidebarItems",(function(e){if(null!==app.session.user&&!0===app.forum.attribute("allowCheckIn")){var t,a=app.current.get("routeName"),n=app.session.user.attribute("totalContinuousCheckIn"),r=app.session.user.attribute("canCheckin"),o=app.session.user.attribute("canCheckinContinuous"),u=(app.session.user.attribute("serverDate"),app.forum.attribute("forumCheckinSuccessPromptType")),s=app.session.user.attribute("checkInCompatibleExtensions"),p=(app.session.user.attribute("lastCheckinTime"),"forum-checkin");if("tag"===a&&-1!==s.indexOf("fof-follow-tags")&&(p="forum-checkin-1"),!0===r){t=app.translator.trans("ziven-checkin.forum.check-in"),e.add(p,c().component({icon:"fas fa-calendar",className:"Button CheckInButton--yellow",itemClassName:"App-primaryControl",id:"checkInButton",onclick:function(){app.session.user.save({canCheckin:!1,totalContinuousCheckIn:!0===o?n+1:1}).then((function(){var e=app.forum.attribute("forumCheckinSuccessPromptText"),t=app.forum.attribute("forumCheckinSuccessPromptRewardText"),a=app.session.user.attribute("canCheckin");if(""!==e||""!==t)if(1===u)if(!1===a){var n=app.forum.attribute("forumCheckinRewarMoney"),r=void 0!==app.forum.attribute("antoinefr-money.moneyname"),o="";if(""!==e){var c=e.replace("[days]",app.session.user.attribute("totalContinuousCheckIn"));app.alerts.show(i(),{type:"success"},c)}if(!0===r&&""!==t){o=(app.forum.attribute("antoinefr-money.moneyname")||"[money]").replace("[money]",n);var s=t.replace("[reward]",o);app.alerts.show(i(),{type:"success"},s)}}else app.alerts.show(i(),{type:"error"},app.translator.trans("ziven-checkin.forum.check-in-failed")+" "+app.translator.trans("ziven-checkin.forum.try-again-later"));else 2===u&&(!1===a?app.modal.show(h):app.modal.show(d))}))}},t),50);var m=app.forum.attribute("forumAutoCheckin"),l=app.forum.attribute("forumAutoCheckinDelay");1===m&&setTimeout((function(){$("#checkInButton").click()}),l)}else t=n<=1?app.translator.trans("ziven-checkin.forum.checked-in-day",{count:n}):app.translator.trans("ziven-checkin.forum.checked-in-days",{count:n}),e.add(p,c().component({icon:"fas fa-calendar-check",className:"Button CheckInButton--green",itemClassName:"App-primaryControl",disabled:!0},t),50)}}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map